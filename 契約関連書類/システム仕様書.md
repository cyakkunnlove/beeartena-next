# Bee Artena 予約管理システム仕様書

**文書バージョン**: 1.0  
**作成日**: 令和＿年＿月＿日  
**作成者**: ＿＿＿＿＿

---

## 1. システム概要

### 1.1 システム名称

Bee Artena（ビーアルテナ）予約管理システム

### 1.2 システムの目的

アートメイクサロン「Bee
Artena」の予約管理、顧客管理、ポイント管理を一元化し、業務効率化と顧客満足度向上を実現する。

### 1.3 主要機能

- オンライン予約受付
- 顧客情報管理
- ポイント管理システム
- 予約・売上分析
- 管理者向け統合ダッシュボード

### 1.4 利用者

- **エンドユーザー**: サロンの顧客（予約・ポイント確認）
- **管理者**: サロンスタッフ（予約管理・顧客対応）
- **システム管理者**: システム全体の管理

---

## 2. システム構成

### 2.1 技術スタック

#### フロントエンド

- **フレームワーク**: Next.js 15.4.1 (App Router)
- **言語**: TypeScript 5
- **UIフレームワーク**: React 18
- **スタイリング**: Tailwind CSS 3.4.1
- **アニメーション**: Framer Motion 12.23.6
- **カレンダー**: React Big Calendar 1.19.4

#### バックエンド

- **API**: Next.js API Routes
- **認証**: Firebase Authentication + JWT
- **データベース**: Firebase Firestore
- **ファイルストレージ**: Firebase Storage

#### インフラ

- **ホスティング**: Vercel
- **ドメイン**: カスタムドメイン対応
- **SSL**: 自動設定（Vercel提供）

### 2.2 システム構成図

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   クライアント  │────▶│   Vercel    │────▶│  Firebase   │
│  (ブラウザ)   │     │  (Next.js)  │     │ (Firestore) │
└─────────────┘     └─────────────┘     └─────────────┘
```

---

## 3. 機能仕様

### 3.1 ユーザー機能

#### 3.1.1 会員登録・認証

- **新規登録**
  - メールアドレス/パスワードによる登録
  - 氏名、電話番号の入力
  - 利用規約への同意
  - メール認証（オプション）

- **ログイン/ログアウト**
  - メールアドレス/パスワードによる認証
  - セッション管理（JWT）
  - 自動ログアウト機能

#### 3.1.2 予約機能

- **予約作成**
  - カレンダーからの日時選択
  - サービスメニュー選択
  - 予約確認画面
  - 予約完了通知

- **予約管理**
  - 予約履歴の確認
  - 予約詳細の表示
  - 予約のキャンセル（24時間前まで）
  - 予約変更（再予約）

#### 3.1.3 ポイント機能

- **ポイント付与**
  - 施術完了時に料金の5%を自動付与
  - ポイント履歴の表示
  - 現在のポイント残高表示

- **ランク制度**
  - Bronze: 0～999ポイント
  - Silver: 1,000～4,999ポイント
  - Gold: 5,000～9,999ポイント
  - Platinum: 10,000ポイント以上

- **ポイント利用**
  - 1ポイント = 1円として利用可能
  - 予約時に使用ポイント数を指定

#### 3.1.4 プロフィール管理

- 個人情報の編集
- パスワード変更
- 退会処理

### 3.2 管理者機能

#### 3.2.1 ダッシュボード

- **統計情報**
  - 本日の予約数
  - 今月の売上
  - 新規顧客数
  - 総顧客数

- **直近の予約一覧**
  - リアルタイム更新
  - ステータス別表示

#### 3.2.2 予約管理

- **予約一覧**
  - フィルタリング（日付、ステータス、顧客）
  - ソート機能
  - 検索機能

- **予約操作**
  - ステータス変更（確認済み、完了、キャンセル）
  - 予約の代理作成
  - 予約メモの追加

#### 3.2.3 顧客管理

- **顧客一覧**
  - 顧客情報の検索・フィルタリング
  - ランク別表示
  - 来店履歴の確認

- **顧客詳細**
  - 個人情報の表示・編集
  - 予約履歴
  - ポイント履歴
  - 特記事項の管理

#### 3.2.4 ポイント管理

- 手動ポイント付与
- ポイント使用処理
- ポイント履歴の確認
- ポイント調整（修正）

#### 3.2.5 問い合わせ管理

- 問い合わせ一覧
- ステータス管理（未対応、対応中、完了）
- 返信機能

### 3.3 サービスメニュー

| サービスID | サービス名        | 料金     | 所要時間 |
| ---------- | ----------------- | -------- | -------- |
| 2D         | パウダーブロウ    | 20,000円 | 120分    |
| 3D         | フェザーブロウ    | 20,000円 | 120分    |
| 4D         | パウダー&フェザー | 25,000円 | 120分    |

---

## 4. データベース設計

### 4.1 コレクション構造

#### users（ユーザー）

```javascript
{
  id: string,
  email: string,
  name: string,
  phone: string,
  role: 'customer' | 'admin',
  points: number,
  rank: 'bronze' | 'silver' | 'gold' | 'platinum',
  createdAt: Date,
  updatedAt: Date
}
```

#### reservations（予約）

```javascript
{
  id: string,
  userId: string,
  date: Date,
  time: string,
  service: {
    id: string,
    name: string,
    price: number,
    duration: number
  },
  status: 'pending' | 'confirmed' | 'completed' | 'cancelled',
  pointsUsed: number,
  totalAmount: number,
  note: string,
  createdAt: Date,
  updatedAt: Date
}
```

#### points（ポイント履歴）

```javascript
{
  id: string,
  userId: string,
  type: 'earned' | 'used' | 'adjusted',
  amount: number,
  balance: number,
  description: string,
  relatedReservationId: string,
  createdAt: Date
}
```

#### inquiries（問い合わせ）

```javascript
{
  id: string,
  userId: string,
  subject: string,
  message: string,
  status: 'pending' | 'in_progress' | 'resolved',
  adminResponse: string,
  createdAt: Date,
  updatedAt: Date
}
```

### 4.2 セキュリティルール

- ユーザーは自分のデータのみ読み書き可能
- 管理者は全データへのアクセス権限
- 認証されていないユーザーはアクセス不可

---

## 5. API仕様

### 5.1 認証API

#### POST /api/auth/register

新規ユーザー登録

**リクエスト**:

```json
{
  "email": "user@example.com",
  "password": "password123",
  "name": "山田太郎",
  "phone": "090-1234-5678"
}
```

**レスポンス**:

```json
{
  "success": true,
  "user": { ... },
  "token": "jwt_token"
}
```

#### POST /api/auth/login

ユーザーログイン

**リクエスト**:

```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**レスポンス**:

```json
{
  "success": true,
  "user": { ... },
  "token": "jwt_token"
}
```

### 5.2 予約API

#### GET /api/reservations

予約一覧取得（要認証）

#### POST /api/reservations

予約作成（要認証）

#### PUT /api/reservations/:id

予約更新（要認証）

#### DELETE /api/reservations/:id

予約キャンセル（要認証）

### 5.3 その他のAPI

- ユーザー管理API
- ポイント管理API
- 問い合わせAPI

---

## 6. セキュリティ仕様

### 6.1 認証・認可

- Firebase Authenticationによる認証
- JWTトークンによるセッション管理
- ロールベースアクセス制御（RBAC）

### 6.2 データ保護

- HTTPS通信の強制
- パスワードのハッシュ化（bcrypt）
- XSS対策（React標準）
- CSRF対策（SameSite Cookie）

### 6.3 API保護

- レート制限（1分間に60リクエストまで）
- CORS設定
- 認証トークンの検証

---

## 7. 画面仕様

### 7.1 ユーザー画面

1. **ホーム画面**
   - サービス紹介
   - 予約ボタン
   - ログイン/新規登録リンク

2. **予約画面**
   - カレンダー表示
   - 時間選択
   - サービス選択
   - 確認画面

3. **マイページ**
   - 予約履歴
   - ポイント残高
   - プロフィール編集

### 7.2 管理画面

1. **ダッシュボード**
   - 統計サマリー
   - 直近の予約
   - クイックアクション

2. **予約管理**
   - 予約カレンダー
   - 予約一覧テーブル
   - 詳細・編集モーダル

3. **顧客管理**
   - 顧客一覧
   - 顧客詳細
   - ポイント管理

---

## 8. 非機能要件

### 8.1 パフォーマンス

- ページロード時間: 3秒以内
- API応答時間: 1秒以内
- 同時接続数: 100ユーザー

### 8.2 可用性

- サービス稼働率: 99.9%
- 計画メンテナンス: 月1回（深夜）

### 8.3 互換性

- ブラウザ: Chrome, Safari, Firefox, Edge（最新版）
- デバイス: PC, タブレット, スマートフォン
- レスポンシブデザイン対応

### 8.4 運用・保守

- エラーログの記録
- バックアップ（Firebaseによる自動バックアップ）
- 監視（Vercel Analytics）

---

## 9. 制約事項

### 9.1 技術的制約

- Firebase無料枠の制限
  - Firestore: 1GB ストレージ
  - 読み取り: 50,000回/日
  - 書き込み: 20,000回/日
- Vercel無料枠の制限
  - 帯域幅: 100GB/月
  - サーバーレス関数実行時間

### 9.2 運用上の制約

- 予約キャンセルは24時間前まで
- ポイント有効期限なし（将来的に実装予定）
- 同時予約は1件まで

---

## 10. 今後の拡張予定

### Phase 2（3ヶ月後）

- LINE連携・通知
- クレジットカード決済
- メール通知機能
- 予約リマインダー

### Phase 3（6ヶ月後）

- 複数店舗対応
- スタッフ指名機能
- 在庫管理連携
- 売上分析レポート

---

## 改訂履歴

| バージョン | 日付             | 変更内容 | 作成者 |
| ---------- | ---------------- | -------- | ------ |
| 1.0        | 令和＿年＿月＿日 | 初版作成 | ＿＿＿ |
