<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebaseçµ±åˆãƒ†ã‚¹ãƒˆ - Bee Artena</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        h2 {
            color: #666;
            margin-top: 30px;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #D97706;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #B45309;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .data-list {
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            max-height: 400px;
            overflow-y: auto;
        }
        .data-item {
            background-color: white;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .test-section {
            border-left: 4px solid #D97706;
            padding-left: 20px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ Bee Artena - Firebaseçµ±åˆãƒ†ã‚¹ãƒˆ</h1>

    <div class="container">
        <h2>1. Firebaseæ¥ç¶šçŠ¶æ…‹</h2>
        <div id="connection-status" class="status info">æ¥ç¶šç¢ºèªä¸­...</div>
    </div>

    <div class="container">
        <h2>2. ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</h2>
        <div class="form-group">
            <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
            <input type="email" id="admin-email" value="admin@beeartena.jp">
        </div>
        <div class="form-group">
            <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
            <input type="password" id="admin-password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›">
        </div>
        <button onclick="loginAsAdmin()">ç®¡ç†è€…ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³</button>
        <div id="login-status" class="status info" style="display:none;"></div>
    </div>

    <div class="container test-section" id="admin-section" style="display:none;">
        <h2>3. ç®¡ç†è€…æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h2>
        
        <h3>äºˆç´„ãƒ‡ãƒ¼ã‚¿ç¢ºèª</h3>
        <button onclick="loadReservations()">äºˆç´„ä¸€è¦§ã‚’å–å¾—</button>
        <div id="reservations-list" class="data-list"></div>

        <h3>é¡§å®¢ãƒ‡ãƒ¼ã‚¿ç¢ºèª</h3>
        <button onclick="loadCustomers()">é¡§å®¢ä¸€è¦§ã‚’å–å¾—</button>
        <div id="customers-list" class="data-list"></div>

        <h3>æ–°è¦é¡§å®¢ä½œæˆ</h3>
        <div class="form-group">
            <label>é¡§å®¢å</label>
            <input type="text" id="customer-name" value="ãƒ†ã‚¹ãƒˆ èŠ±å­">
        </div>
        <div class="form-group">
            <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
            <input type="email" id="customer-email" value="test-hanako@example.com">
        </div>
        <div class="form-group">
            <label>é›»è©±ç•ªå·</label>
            <input type="tel" id="customer-phone" value="090-1234-5678">
        </div>
        <button onclick="createCustomer()">é¡§å®¢ã‚’ä½œæˆ</button>
        <div id="customer-status" class="status info" style="display:none;"></div>

        <h3>æ–°è¦äºˆç´„ä½œæˆ</h3>
        <div class="form-group">
            <label>é¡§å®¢ID</label>
            <input type="text" id="reservation-customer-id" placeholder="é¡§å®¢IDã‚’å…¥åŠ›">
        </div>
        <div class="form-group">
            <label>ã‚µãƒ¼ãƒ“ã‚¹</label>
            <select id="reservation-service">
                <option value="2D">2Dãƒ‘ã‚¦ãƒ€ãƒ¼ãƒ–ãƒ­ã‚¦ - Â¥22,000</option>
                <option value="3D">3Dãƒ•ã‚§ã‚¶ãƒ¼ãƒ–ãƒ­ã‚¦ - Â¥23,000</option>
                <option value="4D">4Dãƒ‘ã‚¦ãƒ€ãƒ¼&ãƒ•ã‚§ã‚¶ãƒ¼ - Â¥25,000</option>
                <option value="wax">çœ‰æ¯›ãƒ¯ãƒƒã‚¯ã‚¹è„±æ¯› - Â¥3,000</option>
                <option value="retouch">å®‰å¿ƒãƒ—ãƒ©ãƒ³ï¼ˆãƒªã‚¿ãƒƒãƒï¼‰ - Â¥11,000</option>
            </select>
        </div>
        <div class="form-group">
            <label>äºˆç´„æ—¥</label>
            <input type="date" id="reservation-date">
        </div>
        <div class="form-group">
            <label>äºˆç´„æ™‚é–“</label>
            <select id="reservation-time">
                <option value="09:00">09:00</option>
                <option value="11:00">11:00</option>
                <option value="13:00">13:00</option>
                <option value="15:00">15:00</option>
                <option value="17:00">17:00</option>
                <option value="18:30">18:30</option>
            </select>
        </div>
        <button onclick="createReservation()">äºˆç´„ã‚’ä½œæˆ</button>
        <div id="reservation-status" class="status info" style="display:none;"></div>
    </div>

    <div class="container">
        <h2>ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼</h2>
        <div id="test-summary" class="data-list"></div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, doc, setDoc, query, where, orderBy, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebaseè¨­å®š
        const firebaseConfig = {
            apiKey: "AIzaSyBXYa8FeHyHQa0jHRfhZjJ4xLYUb4YvFFuA",
            authDomain: "beeart-ena.firebaseapp.com",
            projectId: "beeart-ena",
            storageBucket: "beeart-ena.appspot.com",
            messagingSenderId: "47862693911",
            appId: "1:47862693911:web:f7181ecac113393d5c9c52"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.db = db;
        window.auth = auth;

        // æ¥ç¶šç¢ºèª
        const connectionStatus = document.getElementById('connection-status');
        try {
            const testCollection = collection(db, 'settings');
            connectionStatus.className = 'status success';
            connectionStatus.textContent = 'âœ… Firebaseã«æ­£å¸¸ã«æ¥ç¶šã•ã‚Œã¦ã„ã¾ã™';
        } catch (error) {
            connectionStatus.className = 'status error';
            connectionStatus.textContent = 'âŒ Firebaseæ¥ç¶šã‚¨ãƒ©ãƒ¼: ' + error.message;
        }

        // ä»Šæ—¥ã®æ—¥ä»˜ã‚’è¨­å®š
        document.getElementById('reservation-date').value = new Date().toISOString().split('T')[0];

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å®šç¾©
        window.loginAsAdmin = async function() {
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            const loginStatus = document.getElementById('login-status');
            
            try {
                loginStatus.style.display = 'block';
                loginStatus.className = 'status info';
                loginStatus.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ä¸­...';
                
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                
                loginStatus.className = 'status success';
                loginStatus.textContent = 'âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼UID: ' + userCredential.user.uid;
                
                document.getElementById('admin-section').style.display = 'block';
                
                addTestResult('ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³', true, 'UID: ' + userCredential.user.uid);
            } catch (error) {
                loginStatus.className = 'status error';
                loginStatus.textContent = 'âŒ ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼: ' + error.message;
                addTestResult('ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³', false, error.message);
            }
        };

        window.loadReservations = async function() {
            const listElement = document.getElementById('reservations-list');
            try {
                listElement.innerHTML = '<div class="status info">èª­ã¿è¾¼ã¿ä¸­...</div>';
                
                const q = query(collection(db, 'reservations'), orderBy('date', 'desc'));
                const querySnapshot = await getDocs(q);
                
                listElement.innerHTML = '';
                let count = 0;
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    count++;
                    const item = document.createElement('div');
                    item.className = 'data-item';
                    item.innerHTML = `
                        <strong>äºˆç´„ID:</strong> ${doc.id}<br>
                        <strong>é¡§å®¢å:</strong> ${data.customerName}<br>
                        <strong>ã‚µãƒ¼ãƒ“ã‚¹:</strong> ${data.serviceName}<br>
                        <strong>æ—¥ä»˜:</strong> ${data.date}<br>
                        <strong>æ™‚é–“:</strong> ${data.time}<br>
                        <strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</strong> ${data.status}
                    `;
                    listElement.appendChild(item);
                });
                
                if (count === 0) {
                    listElement.innerHTML = '<div class="status info">äºˆç´„ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                }
                
                addTestResult('äºˆç´„ãƒ‡ãƒ¼ã‚¿å–å¾—', true, `${count}ä»¶ã®äºˆç´„ã‚’å–å¾—`);
            } catch (error) {
                listElement.innerHTML = '<div class="status error">ã‚¨ãƒ©ãƒ¼: ' + error.message + '</div>';
                addTestResult('äºˆç´„ãƒ‡ãƒ¼ã‚¿å–å¾—', false, error.message);
            }
        };

        window.loadCustomers = async function() {
            const listElement = document.getElementById('customers-list');
            try {
                listElement.innerHTML = '<div class="status info">èª­ã¿è¾¼ã¿ä¸­...</div>';
                
                const q = query(collection(db, 'users'), where('role', '==', 'customer'));
                const querySnapshot = await getDocs(q);
                
                listElement.innerHTML = '';
                let count = 0;
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    count++;
                    const item = document.createElement('div');
                    item.className = 'data-item';
                    item.innerHTML = `
                        <strong>é¡§å®¢ID:</strong> ${doc.id}<br>
                        <strong>åå‰:</strong> ${data.name}<br>
                        <strong>ãƒ¡ãƒ¼ãƒ«:</strong> ${data.email}<br>
                        <strong>é›»è©±:</strong> ${data.phone}<br>
                        <strong>ãƒã‚¤ãƒ³ãƒˆ:</strong> ${data.points || 0}pt
                    `;
                    listElement.appendChild(item);
                });
                
                if (count === 0) {
                    listElement.innerHTML = '<div class="status info">é¡§å®¢ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                }
                
                addTestResult('é¡§å®¢ãƒ‡ãƒ¼ã‚¿å–å¾—', true, `${count}ä»¶ã®é¡§å®¢ã‚’å–å¾—`);
            } catch (error) {
                listElement.innerHTML = '<div class="status error">ã‚¨ãƒ©ãƒ¼: ' + error.message + '</div>';
                addTestResult('é¡§å®¢ãƒ‡ãƒ¼ã‚¿å–å¾—', false, error.message);
            }
        };

        window.createCustomer = async function() {
            const statusElement = document.getElementById('customer-status');
            try {
                statusElement.style.display = 'block';
                statusElement.className = 'status info';
                statusElement.textContent = 'ä½œæˆä¸­...';
                
                const customerId = 'customer_' + Date.now();
                const customerData = {
                    name: document.getElementById('customer-name').value,
                    email: document.getElementById('customer-email').value,
                    phone: document.getElementById('customer-phone').value,
                    role: 'customer',
                    points: 0,
                    totalSpent: 0,
                    createdAt: serverTimestamp(),
                    updatedAt: serverTimestamp()
                };
                
                await setDoc(doc(db, 'users', customerId), customerData);
                
                statusElement.className = 'status success';
                statusElement.textContent = 'âœ… é¡§å®¢ä½œæˆæˆåŠŸï¼ID: ' + customerId;
                document.getElementById('reservation-customer-id').value = customerId;
                
                addTestResult('æ–°è¦é¡§å®¢ä½œæˆ', true, 'ID: ' + customerId);
                
                // é¡§å®¢ä¸€è¦§ã‚’å†èª­ã¿è¾¼ã¿
                loadCustomers();
            } catch (error) {
                statusElement.className = 'status error';
                statusElement.textContent = 'âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message;
                addTestResult('æ–°è¦é¡§å®¢ä½œæˆ', false, error.message);
            }
        };

        window.createReservation = async function() {
            const statusElement = document.getElementById('reservation-status');
            try {
                statusElement.style.display = 'block';
                statusElement.className = 'status info';
                statusElement.textContent = 'ä½œæˆä¸­...';
                
                const serviceType = document.getElementById('reservation-service').value;
                const serviceNames = {
                    '2D': '2Dãƒ‘ã‚¦ãƒ€ãƒ¼ãƒ–ãƒ­ã‚¦',
                    '3D': '3Dãƒ•ã‚§ã‚¶ãƒ¼ãƒ–ãƒ­ã‚¦',
                    '4D': '4Dãƒ‘ã‚¦ãƒ€ãƒ¼&ãƒ•ã‚§ã‚¶ãƒ¼',
                    'wax': 'çœ‰æ¯›ãƒ¯ãƒƒã‚¯ã‚¹è„±æ¯›',
                    'retouch': 'å®‰å¿ƒãƒ—ãƒ©ãƒ³ï¼ˆãƒªã‚¿ãƒƒãƒï¼‰'
                };
                const prices = {
                    '2D': 22000,
                    '3D': 23000,
                    '4D': 25000,
                    'wax': 3000,
                    'retouch': 11000
                };
                
                const reservationData = {
                    customerId: document.getElementById('reservation-customer-id').value,
                    customerName: document.getElementById('customer-name').value,
                    customerEmail: document.getElementById('customer-email').value,
                    customerPhone: document.getElementById('customer-phone').value,
                    serviceType: serviceType,
                    serviceName: serviceNames[serviceType],
                    price: prices[serviceType],
                    date: document.getElementById('reservation-date').value,
                    time: document.getElementById('reservation-time').value,
                    status: 'pending',
                    notes: 'Firebaseãƒ†ã‚¹ãƒˆã‹ã‚‰ä½œæˆ',
                    createdAt: serverTimestamp(),
                    updatedAt: serverTimestamp()
                };
                
                const docRef = await addDoc(collection(db, 'reservations'), reservationData);
                
                statusElement.className = 'status success';
                statusElement.textContent = 'âœ… äºˆç´„ä½œæˆæˆåŠŸï¼ID: ' + docRef.id;
                
                addTestResult('æ–°è¦äºˆç´„ä½œæˆ', true, 'ID: ' + docRef.id);
                
                // äºˆç´„ä¸€è¦§ã‚’å†èª­ã¿è¾¼ã¿
                loadReservations();
            } catch (error) {
                statusElement.className = 'status error';
                statusElement.textContent = 'âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message;
                addTestResult('æ–°è¦äºˆç´„ä½œæˆ', false, error.message);
            }
        };

        function addTestResult(testName, success, details) {
            const summaryElement = document.getElementById('test-summary');
            const resultItem = document.createElement('div');
            resultItem.className = 'data-item';
            resultItem.innerHTML = `
                <strong>${success ? 'âœ…' : 'âŒ'} ${testName}</strong><br>
                <small>${new Date().toLocaleTimeString()}</small><br>
                ${details ? '<em>' + details + '</em>' : ''}
            `;
            summaryElement.appendChild(resultItem);
        }
    </script>
</body>
</html>